<!DOCTYPE html>
<html>

<head>
  <title>SL Experiment</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-likert@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-button-response@2.1.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
  <!-- This is for data storage - please be sure to keep this script in all future updates to the code!! -->
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
</head>

<body></body>
<script>

  /* initialize jsPsych */
  var jsPsych = initJsPsych(
    {
      show_progress_bar: true
    }
  );

  //PLEASE KEEP FOR ALL FUTURE ITERATIONS
  //create a unique filename by combining a random string and a millisecond counter (to avoid duplicates)
  var random_id = jsPsych.randomization.randomID(10);
  const date = new Date();
  random_id = "p"+random_id.toString();
  var file_id = random_id + "_" + date.getTime().toString();
  const filename = `${file_id}.csv`;
  //also store the random id for convenience
  jsPsych.data.addProperties({
        random_id: random_id,
      });
  //PLEASE KEEP FOR ALL FUTURE ITERATIONS

  /* create timeline */
  var timeline = [];

  /* welcome */
  var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Welcome to the experiment! Press any key to continue.",
  };

  /* full screen */
  var enter_fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: true
  }
  timeline.push(enter_fullscreen);

  timeline.push(welcome);

// Preload images
const preload = {
  type: jsPsychPreload,
  images: [
    "stimuli/a1_test.png",
    "stimuli/a1_answer1.png",
    "stimuli/a1_answer2.png",
    "stimuli/a1_answer3.png",
    "stimuli/a1_answer4.png",
    "stimuli/a1_answer5.png",
    "stimuli/a1_answer6.png"
  ]
};
timeline.push(preload);

  /* instructions*/
  var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
  <p>In this test, you will complete a series of pattern-based puzzles known as <b>Ravenâ€™s Progressive Matrices</b>.</p>
  <p>Each question will present a pattern with a missing piece,</p>
  <p>and your task is to select the option that best completes the pattern.</p>
  <p>These are not timed, so take as much time as you need.</p>
  <p>Press any key to begin.</p>`
  };

  //add the instructions trial to the timeline
  timeline.push(instructions);

  var likert_scale = [
  "Strongly Disagree", 
  "Disagree", 
  "Neutral", 
  "Agree", 
  "Strongly Agree"
];

var pretest_likert = {
  type: jsPsychSurveyLikert,
  questions: [
    {prompt: "I feel motivated to take this experiment", name: 'Experiment', labels: likert_scale},
    {prompt: "I enjoy listening to music while I study", name: 'Study', labels: likert_scale},
    {prompt: "I like learning new things", name: 'Learning', labels: likert_scale},
  ],
  randomize_question_order: true
};
timeline.push(pretest_likert);

const trial_stimuli = [
  {
    stimulus: "https://github.com/somethingrotten/Cogs164Project/raw/main/stimuli/a1_test.png",  // Test matrix
    choices: [
      "https://github.com/somethingrotten/Cogs164Project/raw/main/stimuli/a1_answer1.png",
      "https://github.com/somethingrotten/Cogs164Project/raw/main/stimuli/a1_answer2.png",
      "https://github.com/somethingrotten/Cogs164Project/raw/main/stimuli/a1_answer3.png",
      "https://github.com/somethingrotten/Cogs164Project/raw/main/stimuli/a1_answer4.png",
      "https://github.com/somethingrotten/Cogs164Project/raw/main/stimuli/a1_answer5.png",
      "https://github.com/somethingrotten/Cogs164Project/raw/main/stimuli/a1_answer6.png"
    ],
    correct_choice: 4
  }
];


const rpm_trials = trial_stimuli.map((stim) => ({
  type: jsPsychImageButtonResponse,
  stimulus: stim.stimulus,
  choices: stim.choices,
  button_html: function() {
    return '<img src="' + stim.choice + '" style="width: 150px; height: 150px; margin: 5px;">'; // Ensure it's using the correct choice path
  },
  data: { correct_choice: stim.correct_choice },
  css: {
    display: 'flex',
    justifyContent: 'center', 
    alignItems: 'center', // Ensure vertical centering
    flexWrap: 'wrap', 
    gap: '15px',       
    maxWidth: '100%', 
  },
  on_finish: function(data) {
    data.correct = (data.response === data.correct_choice);
  }
}));


timeline.push(...rpm_trials); // <-- Fix: Spread the array so trials are added correctly

  //PLEASE KEEP FOR ALL FUTURE ITERATIONS
  //this portion of the code ensures that the data gets sent to be stored on OSF
  var participant_survey = {
    type: jsPsychSurveyText,
    questions: [
    { prompt: "What do you think this experiment was about?" },
    { prompt: "Did you encounter any technical issues?" },
    { prompt: "Was it hard to figure out the puzzles?" }
  ],
  on_finish: function(data){
    console.log(data)
  }
  }
  timeline.push(participant_survey);

  
  const save_data = {
    type: jsPsychPipe,
    action: "save",
    experiment_id: "wCWH7aO7xiIT",
    filename: filename,
    data_string: ()=>jsPsych.data.get().csv()
  };
  timeline.push(save_data);
  //PLEASE KEEP FOR ALL FUTURE ITERATIONS

  var debrief = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
    <p>Thank you for participating!</p>
    <p>This experiment was designed to study if peoples motivation changes when learning</p>
    <p>and listening to different music.</p>
    <p>Press any key to finish.</p>`,
};
timeline.push(debrief);

  /* start the experiment */
  jsPsych.run(timeline);

</script>

</html>