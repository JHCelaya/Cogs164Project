<!DOCTYPE html>
<html>

<head>
  <title>SL Experiment</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-likert@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-button-response@2.1.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
  <!-- This is for data storage - please be sure to keep this script in all future updates to the code!! -->
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
</head>

<body></body>
<script>

  /* initialize jsPsych */
  var jsPsych = initJsPsych(
    {
      show_progress_bar: true
    }
  );

  //PLEASE KEEP FOR ALL FUTURE ITERATIONS
  //create a unique filename by combining a random string and a millisecond counter (to avoid duplicates)
  var random_id = jsPsych.randomization.randomID(10);
  const date = new Date();
  random_id = "p"+random_id.toString();
  var file_id = random_id + "_" + date.getTime().toString();
  const filename = `${file_id}.csv`;
  //also store the random id for convenience
  jsPsych.data.addProperties({
        random_id: random_id,
      });
  //PLEASE KEEP FOR ALL FUTURE ITERATIONS

  /* create timeline */
  var timeline = [];

  /* welcome */
  var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Welcome to the experiment! Press any key to continue.",
  };

  /* full screen */
  var enter_fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: true
  }
  timeline.push(enter_fullscreen);

  timeline.push(welcome);

  /* instructions*/
  var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
  <p>In this experiment, you will see a list of words and try to remember as many as possible.</p>
  <p>Afterward, you will be asked to recall them. Later, you will see another list and do the same.</p>
  <p>There will also be a delayed recall test at the end as well as a couple surveys.</p>
  <p>Press any key to begin.</p>`
  };

  //add the instructions trial to the timeline
  timeline.push(instructions);

  var likert_scale = [
  "Strongly Disagree", 
  "Disagree", 
  "Neutral", 
  "Agree", 
  "Strongly Agree"
];

var pretest_likert = {
  type: jsPsychSurveyLikert,
  questions: [
    {prompt: "I would like to learn something new today", name: 'Experiment', labels: likert_scale},
    {prompt: "I enjoy listening to music while I study", name: 'Study', labels: likert_scale},
    {prompt: "I listen to music consistently throughout the day", name: 'Music', labels: likert_scale},
  ],
  randomize_question_order: true
};
timeline.push(pretest_likert);

// Function to present words with fixation cross
function create_word_trials(word_list, label) {
  let trials = [];
  word_list.forEach(word => {
    // Fixation cross trial
    trials.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p style="font-size: 40px;">+</p>`,
      choices: "NO_KEYS",
      trial_duration: 500,  // Fixation cross shown for 500ms
      data: { phase: label, type: "fixation" }
    });

    // Word presentation trial
    trials.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p style="font-size: 32px;">${word}</p>`,
      choices: "NO_KEYS",
      trial_duration: 1000,  // Word displayed for 1 sec
      data: { phase: label, type: "word", word: word }
    });
  });
  return trials;
}

// **Encoding Phase (List A)**
var word_list_A = [
                  "apple", 
                  "table", 
                  "dog", 
                  "sun", 
                  "chair", 
                  "pencil", 
                  "river", 
                  "moon", 
                  "house", 
                  "flower"
                ];
timeline.push(...create_word_trials(word_list_A, "encoding"));

// ⏳ **Immediate Recall (Participants Type Words)**
var immediate_recall = {
  type: jsPsychSurveyText,
  questions: [{prompt: "List all the words you remember:", rows: 5, columns: 40}],
  data: { phase: "immediate_recall" }
};
timeline.push(immediate_recall);

// **Interference List (New Word List B)**
var word_list_B = [
                  "phone", 
                  "candle", 
                  "ocean", 
                  "guitar", 
                  "mouse", 
                  "book",
                  "lamp", 
                  "bridge", 
                  "mountain", 
                  "car"
                ];
timeline.push(...create_word_trials(word_list_B, "interference"));


var math_problems = [
  { question: "8 × 3 = ?", choices: ["21", "24", "26", "28"], correct_index: 1 },
  { question: "15 - 9 = ?", choices: ["5", "6", "7", "8"], correct_index: 1 },
  { question: "25 ÷ 5 = ?", choices: ["4", "5", "6", "7"], correct_index: 1 }
];

// Generate trials
math_problems.forEach((problem) => {
  timeline.push({
    type: jsPsychHtmlButtonResponse,
    stimulus: `<p>${problem.question}</p>`,
    choices: problem.choices,
    data: { phase: "math_distractor", correct_choice: problem.correct_index },
    on_finish: function(data) {
      data.correct = (data.response === problem.correct_index);
    }
  });
});

// Delayed Recall (After Interference)
var delayed_recall = {
  type: jsPsychSurveyText,
  questions: [{prompt: "List all the words you remember from the FIRST list:", rows: 5, columns: 40}]
};
timeline.push(delayed_recall);

// Recognition Test (Mix of Old and New Words)
var all_words = jsPsych.randomization.shuffle([...word_list_A, ...word_list_B, "tree", "window", "cloud"]);
var recognition_trials = all_words.map(word => ({
  type: jsPsychHtmlButtonResponse,
  stimulus: `<p>Did you see this word in the FIRST list?</p><p><strong>${word}</strong></p>`,
  choices: ["Yes", "No"]
}));
timeline.push(...recognition_trials);

var posttest_likert = {
  type: jsPsychSurveyLikert,
  questions: [
    {prompt: "I felt like the lofi helped me focus", name: 'lofi', labels: likert_scale},
    {prompt: "I enjoyed listening to music while I did the experiment", name: 'Enjoyment', labels: likert_scale},
    {prompt: "I felt more motivated to try when listening to music", name: 'Motive', labels: likert_scale},
  ],
  randomize_question_order: true
};
timeline.push(posttest_likert);

  //PLEASE KEEP FOR ALL FUTURE ITERATIONS
  //this portion of the code ensures that the data gets sent to be stored on OSF
  var participant_survey = {
    type: jsPsychSurveyText,
    questions: [
    { prompt: "What do you think this experiment was about?" },
    { prompt: "Did you encounter any technical issues?" },
    { prompt: "Was it hard to figure out the puzzles?" }
  ],
  on_finish: function(data){
    console.log(data)
  }
  }
  timeline.push(participant_survey);

  
  const save_data = {
    type: jsPsychPipe,
    action: "save",
    experiment_id: "wCWH7aO7xiIT",
    filename: filename,
    data_string: ()=>jsPsych.data.get().csv()
  };
  timeline.push(save_data);
  //PLEASE KEEP FOR ALL FUTURE ITERATIONS

  var debrief = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
    <p>Thank you for participating!</p>
    <p>This experiment was designed to study if peoples motivation changes when learning</p>
    <p>and listening to different music.</p>
    <p>Press any key to finish.</p>`,
};
timeline.push(debrief);

  /* start the experiment */
  jsPsych.run(timeline);

</script>

</html>