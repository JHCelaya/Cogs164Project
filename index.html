<!DOCTYPE html>
<html>

<head>
  <title>SL Experiment</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
  <!-- This is for data storage - please be sure to keep this script in all future updates to the code!! -->
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
</head>

<body></body>
<script>

  /* initialize jsPsych */
  var jsPsych = initJsPsych(
    {
      show_progress_bar: true
    }
  );

  //PLEASE KEEP FOR ALL FUTURE ITERATIONS
  //create a unique filename by combining a random string and a millisecond counter (to avoid duplicates)
  var random_id = jsPsych.randomization.randomID(10);
  const date = new Date();
  random_id = "p"+random_id.toString();
  var file_id = random_id + "_" + date.getTime().toString();
  const filename = `${file_id}.csv`;
  //also store the random id for convenience
  jsPsych.data.addProperties({
        random_id: random_id,
      });
  //PLEASE KEEP FOR ALL FUTURE ITERATIONS

  /* create timeline */
  var timeline = [];


  // Set up the preload with the specific image paths
  var preload = {
    type: jsPsychPreload,
    images: image_paths // Specify the images array for preloading
  };
timeline.push(preload)

  /* welcome */
  var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Welcome to the experiment. Press any key to begin.",
  };

  /* full screen */
  var enter_fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: true
  }
  timeline.push(enter_fullscreen);

  /* participant ID */
  var participant_id_entry = {
    type: jsPsychSurveyText,
    questions: [{ prompt: "Please enter your participant ID (e.g. p1):", name: "participant_id" }],
    on_finish: function (data) {
      console.log(data.response)
      jsPsych.data.addProperties({
        participant: data.response.participant_id
      });
    }
  };

  timeline.push(welcome);

  timeline.push(participant_id_entry);
  /* instructions*/
  var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
  <p>For this trial, you will see a series of images.</p>
  <p><b>Press the spacebar whenever you see the same image appear twice in a row.</b></p>
  <p>In other words, whenever the same image repeats back to back, press the spacebar.</p>
  <p>Press any key to begin.</p>`
  };

  //add the instructions trial to the timeline
  timeline.push(instructions);

  //PLEASE KEEP FOR ALL FUTURE ITERATIONS
  //this portion of the code ensures that the data gets sent to be stored on OSF
  var participant_survey = {
    type: jsPsychSurveyText,
    questions: [
    { prompt: "What do you think this experiment was about?" },
    { prompt: "Did you encounter any technical issues?" },
    { prompt: "Was it hard to recall the sequences?" }
  ],
  on_finish: function(data){
    console.log(data)
  }
  }
  timeline.push(participant_survey);

  const save_data = {
    type: jsPsychPipe,
    action: "save",
    experiment_id: "PAfzfuHy0doi",
    filename: filename,
    data_string: () => jsPsych.data.get().csv()
  };
  timeline.push(save_data);
  //PLEASE KEEP FOR ALL FUTURE ITERATIONS

  var debrief = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `
    <p>Thank you for participating!</p>
    <p>This experiment was designed to study how people recognize patterns in images.</p>
    <p>Press any key to finish.</p>`,
};
timeline.push(debrief);

  /* start the experiment */
  jsPsych.run(timeline);

</script>

</html>
